# Can ! automatically detect emails that are SPAM from HAM?
# Make it concrete - Can I use quantitative characteristics of the emails to classif them as SPAM or HAM?
# install the kernlab package
library("kernlab", lib.loc="/Users/simon/Library/R/2.15/library")
data(spam)
# http://rss.acs.unt.edu/Rdoc/library/kernlab/html/spam.html
# create a test and training set (prediction)
set.seed(3435)
trainIndicator = rbinom(4601,size=1,prob=0.5)
table(trainIndicator)
trainSpam = spam[trainIndicator==1,]
testSpam = spam[trainIndicator==0,]
dim(trainSpam)
# Explore the data
names(trainSpam) # have a look at the column names
head(trainSpam) # have a look at the data
table(trainSpam$type) # have a look at summaries of the data
plot(trainSpam$capitalAve ~ trainSpam$type) # have a look at some plots
plot(log10(trainSpam$captialAve + 1) ~ trainSpam$type)
plot(log10(trainSpam[,1:4]+1))
# clustering
hCluster = hclust(dist(t(trainSpam[,1:57])))
plot(hCluster)
hClusterUpdated = hclust(dist(t(log10(trainSpam[,1:55]+1))))
plot(hClusterUpdated)
# modeling/statistical prediction
trainSpam$numType = as.numeric(trainSpam$type)-1
costFunction = function(x,y){sum(x != (y > 0.5))}
cvError = rep(NA,55)
library(boot)
for (i in 1:55) {
  lmFormula = as.formula(paste("numType~",names(trainSpam)[i],sep=""))
  glmFit = glm(lmFormula,family="binomial",data=trainSpam)
  cvError[i] = cv.glm(trainSpam,glmFit,costFunction,2)$delta[2]
}
which.min(cvError)
names(trainSpam)[which.min(cvError)]
# measure of uncertainty
predictionModel = glm(numType ~ charDollar,family="binomial",data=trainSpam)
predictionTest = predict(predictionModel,testSpam)
predictedSpam = rep("nonspam",dim(testSpam)[1])
predictedSpam[predictionModel$fitted > 0.5] = "spam"
table(predictedSpam,testSpam$type)
errorRate = (61 + 458)/(1346+458+61+449)
# interpret the results
# show what was found and error rate

# Organising a data analysis
